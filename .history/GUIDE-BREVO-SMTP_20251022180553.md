# 📧 Configuration Brevo (Sendinblue) SMTP - Guide Complet

## ✅ Avantages de Brevo vs Gmail

| Critère | Gmail SMTP | Brevo SMTP |
|---------|------------|------------|
| **Fonctionne sur Vercel** | ❌ Bloqué par sécurité | ✅ Parfaitement compatible |
| **Gratuit** | ✅ Oui | ✅ Oui (300 emails/jour) |
| **Configuration** | Complexe (2FA + App Password) | Simple (1 clé API) |
| **IPs serveur Vercel** | ❌ Bloquées | ✅ Autorisées |
| **Délivrabilité** | Moyenne | ⭐ Excellente |
| **Limite emails/jour** | 500 | 300 (gratuit) |
| **Statistiques** | ❌ Non | ✅ Dashboard complet |

---

## 🚀 Étape 1 : Créer votre compte Brevo (2 minutes)

### 1.1 Inscription

1. Allez sur **https://www.brevo.com/fr/**
2. Cliquez sur **"S'inscrire gratuitement"** (en haut à droite)
3. Remplissez le formulaire :
   - **Email** : `lesptitsloupiotscharentais@gmail.com`
   - **Mot de passe** : Créez-en un fort
   - **Nom de l'entreprise** : "Les Ptits Loupiots Charentais"
   - **Site web** : `https://lesptitsloupiotscharentais.fr`
4. Cliquez sur **"Créer mon compte"**

### 1.2 Validation email

1. Allez dans votre boîte Gmail `lesptitsloupiotscharentais@gmail.com`
2. Ouvrez l'email de Brevo : "Confirmez votre adresse email"
3. Cliquez sur le bouton de validation
4. Vous serez redirigé vers le dashboard Brevo

---

## 🔑 Étape 2 : Obtenir votre clé SMTP (3 minutes)

### 2.1 Accéder aux paramètres SMTP

1. Une fois connecté à Brevo, cliquez sur votre **nom/avatar** (en haut à droite)
2. Dans le menu déroulant, cliquez sur **"Paramètres"**
3. Dans le menu de gauche, cherchez **"SMTP & API"**
4. Cliquez sur **"SMTP"** (premier onglet)

### 2.2 Créer une clé SMTP

Vous verrez les informations suivantes :

```
Serveur SMTP : smtp-relay.brevo.com
Port : 587
Login : lesptitsloupiotscharentais@gmail.com
Mot de passe SMTP : [À créer]
```

1. Cliquez sur le bouton **"Créer une nouvelle clé SMTP"**
2. Dans la popup :
   - **Nom** : "Site Web Les Ptits Loupiots"
   - Cliquez sur **"Générer"**
3. ⚠️ **IMPORTANT** : Une clé apparaît (exemple : `xkeysib-a1b2c3d4...`)
   - **COPIEZ-LA IMMÉDIATEMENT** 📋
   - Vous ne pourrez **PLUS JAMAIS** la revoir après avoir fermé cette fenêtre !
   - Si vous la perdez, vous devrez en créer une nouvelle

### 2.3 Où coller la clé ?

**Format de la clé :**
```
xkeysib-a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```
(environ 64 caractères)

---

## 💻 Étape 3 : Configuration locale (.env.local)

### 3.1 Ouvrir le fichier

Ouvrez le fichier `.env.local` à la racine de votre projet.

### 3.2 Remplacer la clé

Remplacez :
```bash
BREVO_SMTP_KEY=votre_cle_smtp_brevo_ici
```

Par votre vraie clé (exemple) :
```bash
BREVO_SMTP_KEY=xkeysib-a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```

### 3.3 Fichier final

Votre `.env.local` doit ressembler à ça :
```bash
# Configuration Brevo (Sendinblue) SMTP
BREVO_SMTP_USER=lesptitsloupiotscharentais@gmail.com
BREVO_SMTP_KEY=xkeysib-a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```

---

## ☁️ Étape 4 : Configuration Vercel (Production)

### 4.1 Supprimer les anciennes variables Gmail

1. Allez sur https://vercel.com/dashboard
2. Sélectionnez votre projet **lesptitsloupiotscharentais**
3. Cliquez sur **Settings** (menu du haut)
4. Dans le menu de gauche : **Environment Variables**
5. **Supprimez** ces variables (si elles existent) :
   - ❌ `GMAIL_USER` → Cliquez sur les 3 points → Delete
   - ❌ `GMAIL_APP_PASSWORD` → Cliquez sur les 3 points → Delete

### 4.2 Ajouter les variables Brevo

**Variable 1 :**
```
Key (Name):   BREVO_SMTP_USER
Value:        lesptitsloupiotscharentais@gmail.com
```
Environnements : ✅ **Production** ✅ **Preview** ✅ **Development**

Cliquez sur **"Add"** ou **"Save"**

---

**Variable 2 :**
```
Key (Name):   BREVO_SMTP_KEY
Value:        xkeysib-a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```
Environnements : ✅ **Production** ✅ **Preview** ✅ **Development**

Cliquez sur **"Add"** ou **"Save"**

⚠️ **Important** : Cochez bien les 3 environnements (Production, Preview, Development)

---

## 🚀 Étape 5 : Déployer les changements

### 5.1 Vérifier les modifications

```bash
git status
```

Vous devriez voir :
- `modified:   src/app/api/contact/route.ts`
- `modified:   .env.local` (ne sera PAS poussé sur Git, c'est normal)

### 5.2 Commit et push

```bash
git add .
git commit -m "Migration Gmail vers Brevo SMTP pour production Vercel"
git push
```

### 5.3 Attendre le déploiement

1. Allez sur https://vercel.com/dashboard
2. Vous verrez un déploiement en cours (Building...)
3. Attendez 2-3 minutes
4. Status : ✅ **Ready**

---

## ✅ Étape 6 : Tester l'envoi d'email

### 6.1 Test en production

1. Allez sur **https://lesptitsloupiotscharentais.fr/contact**
2. Remplissez le formulaire :
   - Nom : Test Brevo
   - Email : votre.email@test.com
   - Sujet : Test envoi Brevo
   - Message : Ceci est un test d'envoi via Brevo SMTP
3. Cliquez sur **"Envoyer mon message"**
4. Vous devriez voir : ✅ **"Message envoyé avec succès !"**

### 6.2 Vérifier la réception

1. Ouvrez votre Gmail **lesptitsloupiotscharentais@gmail.com**
2. L'email devrait arriver en **moins de 10 secondes** ⚡
3. Vérifiez aussi le **dossier Spam** (parfois au début)
4. Si c'est dans les spams, cliquez sur **"Non spam"**

### 6.3 Vérifier dans Brevo

1. Retournez sur https://app.brevo.com
2. Menu de gauche : **"Statistiques"** → **"Email"**
3. Vous verrez :
   - ✅ Emails envoyés : 1
   - ✅ Emails délivrés : 1
   - ✅ Taux d'ouverture : (une fois ouvert)

---

## 🎯 Statistiques Brevo (Dashboard)

Brevo vous offre un dashboard avec :
- 📊 **Nombre d'emails envoyés** (quota : 300/jour gratuit)
- ✅ **Taux de délivrabilité** (% d'emails bien reçus)
- 📧 **Taux d'ouverture** (qui ouvre vos emails)
- 🔗 **Clics sur liens** (si vous mettez des liens)
- ❌ **Bounces** (emails rejetés)
- 📝 **Historique complet** de tous les emails

Pour y accéder :
- https://app.brevo.com → **"Statistiques"** → **"Email"**

---

## 🔧 Dépannage

### Problème : "Erreur lors de l'envoi"

**Solutions :**
1. Vérifiez que la clé SMTP est bien copiée **sans espaces** ni retours à la ligne
2. Vérifiez que les variables sont bien sur Vercel (Settings → Environment Variables)
3. Refaites un déploiement : `git commit --allow-empty -m "Redeploy" && git push`
4. Attendez 2-3 min après l'ajout des variables sur Vercel

### Problème : "Invalid credentials"

**Cause :** Clé SMTP incorrecte

**Solution :**
1. Retournez sur Brevo → Paramètres → SMTP & API
2. Supprimez l'ancienne clé SMTP
3. Créez une nouvelle clé
4. Mettez à jour `.env.local` ET Vercel avec la nouvelle clé

### Problème : Email dans les spams

**Normal** au début. Pour améliorer :
1. Marquez l'email comme **"Non spam"** dans Gmail
2. Ajoutez `lesptitsloupiotscharentais@gmail.com` dans vos contacts
3. Ouvrez plusieurs emails → Gmail apprendra que c'est légitime
4. **Optionnel (avancé)** : Configurez SPF/DKIM sur votre domaine

### Problème : Quota dépassé (300 emails)

**Si vous dépassez 300 emails/jour :**
1. Attendez le lendemain (quota se réinitialise à minuit)
2. **OU** passez au plan payant Brevo (9€/mois pour 5 000 emails)
3. **OU** utilisez plusieurs comptes Brevo (pas recommandé)

---

## 📊 Limites du plan gratuit Brevo

| Fonctionnalité | Plan Gratuit |
|----------------|--------------|
| Emails/jour | **300** |
| Emails/mois | **9 000** |
| Contacts | **Illimité** |
| Templates | **Illimité** |
| SMTP | ✅ Oui |
| API | ✅ Oui |
| Statistiques | ✅ Complètes |
| Support | Email (48h) |
| Logo Brevo | ⚠️ Oui (en bas des emails) |

💡 **Pour votre usage** (formulaire de contact) : 300 emails/jour est **largement suffisant** !

---

## ✅ Checklist finale

- [ ] Compte Brevo créé et email validé
- [ ] Clé SMTP générée et copiée
- [ ] `.env.local` mis à jour avec la clé
- [ ] Variables ajoutées sur Vercel (BREVO_SMTP_USER + BREVO_SMTP_KEY)
- [ ] Anciennes variables Gmail supprimées de Vercel
- [ ] Code poussé sur GitHub (`git push`)
- [ ] Déploiement Vercel terminé (status Ready)
- [ ] Test d'envoi réussi depuis le formulaire
- [ ] Email reçu dans Gmail

---

## 🎉 Résultat attendu

Une fois tout configuré :
1. Visiteur remplit le formulaire sur `/contact`
2. Email envoyé via **Brevo SMTP** en **< 2 secondes**
3. Email reçu dans **lesptitsloupiotscharentais@gmail.com** en **< 10 secondes**
4. Vous pouvez **répondre directement** via Gmail (grâce au `replyTo`)
5. Statistiques visibles sur **Brevo Dashboard**

---

**Besoin d'aide ?** Contactez-moi à chaque étape !

📧 **Service email désormais fiable et professionnel !** ✅
